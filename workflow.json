{
  "version": "1.0",
  "inputs": [
    {
      "type": "InferenceImage",
      "name": "image"
    },
    {
      "type": "InferenceParameter",
      "name": "prompt",
      "default_value": "ferret"
    },
    {
      "type": "InferenceParameter",
      "name": "threshold",
      "default_value": 0.16
    }
  ],
  "steps": [
    {
      "type": "roboflow_core/clip_embedding_model@v1",
      "name": "image",
      "image": "$inputs.image",
      "version": "RN50"
    },
    {
      "type": "roboflow_core/clip_embedding_model@v1",
      "name": "text",
      "data": "$inputs.prompt",
      "version": "RN50"
    },
    {
      "type": "roboflow_core/cosine_similarity@v1",
      "name": "cosine_similarity",
      "embedding_1": "$steps.text.embedding",
      "embedding_2": "$steps.image.embedding"
    },
    {
      "type": "roboflow_core/expression@v1",
      "name": "matches",
      "data": {
        "similarity": "$steps.cosine_similarity.similarity",
        "threshold": "$inputs.threshold"
      },
      "switch": {
        "type": "CasesDefinition",
        "cases": [
          {
            "type": "CaseDefinition",
            "condition": {
              "type": "StatementGroup",
              "statements": [
                {
                  "type": "BinaryStatement",
                  "left_operand": {
                    "type": "DynamicOperand",
                    "operand_name": "similarity"
                  },
                  "comparator": {
                    "type": "(Number) >"
                  },
                  "right_operand": {
                    "type": "DynamicOperand",
                    "operand_name": "threshold"
                  }
                }
              ]
            },
            "result": {
              "type": "StaticCaseResult",
              "value": true
            }
          }
        ],
        "default": {
          "type": "StaticCaseResult",
          "value": false
        }
      }
    }
  ],
  "outputs": [
    {
      "type": "JsonField",
      "name": "is_match",
      "selector": "$steps.matches.output"
    },
    {
      "type": "JsonField",
      "name": "similarity",
      "selector": "$steps.cosine_similarity.similarity"
    }
  ]
}